# CHERI-MIPS capability monotonicity proof

This repository contains a proof of capability monotonicity of the CHERI-MIPS
architecture specified in Sail.  The proof uses the version of the architecture
in commit `4d8457c1` of the [sail-cheri-mips][sail-cheri-mips] repository.

## Proof structure

The [proof](proof/) directory contains the following files:

  * The files `capabilities.lem` and `cheri_axioms.lem` contain an ISA
    abstraction and local properties that each instruction of the architecture
    has to satisfy to guarantee capability monotonicity.  These files have been
    translated by the Lem tool into Isabelle theories with corresponding names.

  * The `Properties.thy` file contains the capability monotonicity proof above
    this abstract model.

  * The `CHERI_MIPS_Instantiation.thy` file contains the instantiation of the
    abstract model for the Sail-CHERI-MIPS specification.

  * The files `CHERI_MIPS_Reg_Axioms.thy` and `CHERI_MIPS_Mem_Axioms.thy`
    contain proofs that all instructions of CHERI-MIPS satisfy the required
    local properties.  This is supported by lemmas and proof infrastructure in
    a number of files, e.g. `CHERI_MIPS_Gen_Lemmas.thy` with generated register
    footprint lemmas about the functions in the specification, or
    `Recognising_Automata.thy` with proof tools for verifying the
    instruction-local properties.

  * The `CHERI_MIPS_Properties.thy` file contains the instantiation of the
    capability monotonicity theorem for CHERI-MIPS.

Parts of the proof about the bulk of the architecture were originally generated
automatically using the `gen_lemmas.ml` tool (in the [tools](tools/) directory)
written in OCaml, although it is not advisable to re-run this tool any more, as
the proofs have since been edited manually.  The tool used the `fp.json` file
with information about the call graph of functions in the architecture, the
types of functions and the registers they access;  this file was generated by a
patched version of Sail (commit `02e33d24`).

## Running the proofs

The proof requires [Isabelle 2019][Isabelle2019].
The proof has last been tested with the following versions of dependencies:
  * [sail-cheri-mips][sail-cheri-mips] commit `4d8457c1`
  * [Sail][sail] commit `63343363`
  * [Lem][lem] commit `a839114`
  * [Isabelle 2019][Isabelle2019]

The proof scripts depend on the Lem and Sail libraries as well as the Isabelle
definitions generated from the `sail-cheri-mips` specification.  This
repository contains snapshots of these in the [lib](lib/) and
[sail-cheri-mips](sail-cheri-mips/) directories.  The proof can be inspected
interactively by running (in this directory)
```
isabelle jedit -d . -l Sail-CHERI-MIPS proof/CHERI_MIPS_Properties.thy
```
or checked non-interactively using
```
isabelle build -D .
```
The proof takes around 5 minutes to process on an Intel W-2145 CPU @ 3.70GHz,
in addition to 5 minutes to process the CHERI-MIPS specification.

A snapshot of the typeset version of the proof scripts produced by Isabelle can
be found in [proof/document/output.pdf](proof/document/output.pdf).

## People and funding

The capability monotonicity proof for Sail-CHERI-MIPS has been developed by
Thomas Bauereiss.  The [WordExtra](proof/Word_Extra.thy) library was developed
by Kyndylan Nienhuis, with contributions from Thomas Bauereiss.

The proof depends on the [sail-cheri-mips][sail-cheri-mips] specification and
the [Lem][lem] and [Sail][sail] libraries;  the
[sail-cheri-mips](sail-cheri-mips/) and [lib](lib/) directories contain
snaphots of those including licence files with copyright and funding
information.

This work was supported by the Innovate UK project Digital Security by
Design (DSbD) Technology Platform Prototype, 105694.

This work was supported by EPSRC programme grant EP/K008528/1 (REMS:
Rigorous Engineering for Mainstream Systems).

This project has received funding from the European Research Council
(ERC) under the European Unionâ€™s Horizon 2020 research and innovation
programme (grant agreement 789108, ELVER).

This work was supported by the Defense Advanced Research Projects
Agency (DARPA) and the Air Force Research Laboratory (AFRL), under the
contract FA8650-18-C-7809 (CIFV).

## Licence

The proof is made available under the BSD three-clause licence in
[LICENCE](LICENCE);  the snaphots of dependencies in the
[sail-cheri-mips](sail-cheri-mips/) and [lib](lib/) directories contain copies
of the two-clause or three-clause BSD licences under which they are
distributed.

[sail-cheri-mips]: https://github.com/CTSRD-CHERI/sail-cheri-mips
[sail]: https://github.com/rems-project/sail
[lem]: https://github.com/rems-project/lem
[Isabelle2019]: https://isabelle.in.tum.de/website-Isabelle2019/index.html
